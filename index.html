l<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RP Instagram</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
/* ======== Geral ======== */
body {
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #4b6cb7, #182848);
  color: #fff;
  margin: 0;
  padding: 0;
}

header {
  background: rgba(0,0,0,0.6);
  padding: 20px;
  font-size: 28px;
  font-weight: bold;
  text-align: center;
  letter-spacing: 2px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

/* ======== Container ======== */
.container {
  max-width: 400px;
  margin: 60px auto 40px auto;
  background: rgba(0,0,0,0.5);
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.5);
}

/* ======== Inputs ======== */
input, textarea {
  padding: 12px;
  margin: 10px 0;
  width: 100%;
  border-radius: 8px;
  border: none;
  outline: none;
  font-size: 16px;
}

input:focus, textarea:focus {
  box-shadow: 0 0 8px #4b6cb7;
}

/* ======== Buttons ======== */
button {
  background: linear-gradient(90deg, #4b6cb7, #182848);
  color: white;
  font-size: 16px;
  font-weight: bold;
  border: none;
  padding: 12px;
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

button:hover {
  background: linear-gradient(90deg, #182848, #4b6cb7);
  transform: translateY(-2px);
}

/* ======== APP Sections ======== */
.hidden { display: none; }
.post {
  border: 1px solid rgba(255,255,255,0.2);
  padding: 12px;
  margin-top: 15px;
  border-radius: 10px;
  background: rgba(0,0,0,0.3);
}
img { max-width: 100%; border-radius: 8px; margin-top: 10px; }
.like-btn, .comment-btn {
  margin-top: 5px;
  cursor: pointer;
  color: #ff6b81;
  background: none;
  border: none;
  font-size: 14px;
}
.comments { margin-left: 10px; margin-top: 5px; font-size: 14px; color: #ddd; }

/* ======== Login ======== */
#login h2 {
  text-align: center;
  margin-bottom: 20px;
  font-size: 24px;
  color: #ffb347;
}
</style>
</head>
<body>

<header>üì∏ RP Instagram</header>

<div class="container">

<!-- LOGIN -->
<div id="login">
  <h2>Login / Registrar</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="senha" type="password" placeholder="Senha">
  <button onclick="login()">Entrar / Registrar</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <button onclick="logout()">Sair</button>
  
  <h3>Perfil</h3>
  <input id="displayName" placeholder="Seu nome">
  <input type="file" id="profilePhoto">
  <button onclick="atualizarPerfil()">Atualizar Perfil</button>
  
  <h3>Nova Postagem</h3>
  <textarea id="caption" placeholder="Escreva algo..."></textarea>
  <input type="file" id="imageFile">
  <button onclick="criarPost()">Postar</button>
  
  <h3>Feed</h3>
  <div id="feed"></div>
</div>

</div>

<script>
// üîë CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyDtjf7IaX2Plj_rx0z2wb_ZAXjlWLbv7u8",
  authDomain: "rpinstagram-ef67e.firebaseapp.com",
  projectId: "rpinstagram-ef67e",
  storageBucket: "rpinstagram-ef67e.firebasestorage.app",
  messagingSenderId: "97404032370",
  appId: "1:97404032370:web:38626b837cfdbad86179eb"
};

// Inicializa Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

// üîê LOGIN / REGISTRO
function login() {
  const e = email.value;
  const s = senha.value;

  auth.signInWithEmailAndPassword(e, s)
    .catch(() => auth.createUserWithEmailAndPassword(e, s));
}

// üö™ LOGOUT
function logout() { auth.signOut(); }

// üë§ ESTADO DO LOGIN
auth.onAuthStateChanged(user => {
  if (user) {
    login.style.display = "none";
    app.classList.remove("hidden");
    carregarFeed();
    carregarPerfil();
  } else {
    login.style.display = "block";
    app.classList.add("hidden");
  }
});

// üñä Atualizar perfil
async function atualizarPerfil() {
  const user = auth.currentUser;
  if (!user) return;

  let photoURL = user.photoURL;
  const file = profilePhoto.files[0];
  if (file) {
    const storageRef = storage.ref().child(`profiles/${user.uid}`);
    await storageRef.put(file);
    photoURL = await storageRef.getDownloadURL();
  }

  await user.updateProfile({
    displayName: displayName.value || user.displayName,
    photoURL
  });

  alert("Perfil atualizado!");
}

// üì∏ CRIAR POST
async function criarPost() {
  const user = auth.currentUser;
  const captionText = caption.value;
  const file = imageFile.files[0];
  if (!user || !file) return alert("Escolha uma imagem e escreva algo!");

  const storageRef = storage.ref().child(`posts/${Date.now()}_${file.name}`);
  await storageRef.put(file);
  const url = await storageRef.getDownloadURL();

  db.collection("posts").add({
    ownerId: user.uid,
    caption: captionText,
    imageURL: url,
    likes: 0,
    comments: [],
    createdAt: new Date()
  });

  caption.value = "";
  imageFile.value = "";
}

// üìÇ CARREGAR FEED
function carregarFeed() {
  db.collection("posts")
    .orderBy("createdAt", "desc")
    .onSnapshot(snapshot => {
      feed.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        const postDiv = document.createElement("div");
        postDiv.className = "post";
        postDiv.innerHTML = `
          <strong>${data.ownerId}</strong>
          <img src="${data.imageURL}">
          <p>${data.caption}</p>
          <button class="like-btn" onclick="curtir('${doc.id}')">‚ù§Ô∏è ${data.likes}</button>
          <div class="comments" id="comments-${doc.id}">
            ${data.comments.map(c => `<p>${c}</p>`).join('')}
          </div>
          <input type="text" id="comment-input-${doc.id}" placeholder="Comentar...">
          <button class="comment-btn" onclick="comentar('${doc.id}')">Comentar</button>
        `;
        feed.appendChild(postDiv);
      });
    });
}

// ‚ù§Ô∏è Curtir post
function curtir(postId) {
  const postRef = db.collection("posts").doc(postId);
  postRef.update({
    likes: firebase.firestore.FieldValue.increment(1)
  });
}

// üí¨ Comentar post
function comentar(postId) {
  const input = document.getElementById(`comment-input-${postId}`);
  const commentText = input.value;
  if (!commentText) return;
  db.collection("posts").doc(postId).update({
    comments: firebase.firestore.FieldValue.arrayUnion(commentText)
  });
  input.value = "";
}

// ‚öô Carregar perfil do usu√°rio
function carregarPerfil() {
  const user = auth.currentUser;
  if (!user) return;
  displayName.value = user.displayName || "";
}
</script>

</body>
</html>
